#!/bin/bash

DOTPATH="$HOME/.dotfiles"
BACKUPPATH="$HOME/.dotfiles-backup"
COLOR_GRAY="\033[1;38;5;243m"
COLOR_BLUE="\033[1;34m"
COLOR_GREEN="\033[1;32m"
COLOR_RED="\033[1;31m"
COLOR_PURPLE="\033[1;35m"
COLOR_YELLOW="\033[1;33m"
COLOR_NONE="\033[0m"

greeting() {
  echo -e "\nHello, ${COLOR_BLUE}dotfiles${COLOR_NONE}.\n"
}

has() {
  type "$1" > /dev/null 2>&1
}

error() {
  echo -e "${COLOR_RED}Error: ${COLOR_NONE}$1"
  exit 1
}

init() {
  echo -e "Start to setup new environment..."
  cd ${DOTPATH}

  echo -e 'Start to install Homebrew...'
  which brew >/dev/null 2>&1 || \
  /usr/bin/ruby -e \
    "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
  which brew >/dev/null 2>&1 && brew doctor
  which brew >/dev/null 2>&1 && brew update --verbose

  echo 'Start to upgrade Homebrew...'
  brew upgrade

  echo 'Start to install brew formulas...'
  brew bundle --verbose
  brew cleanup
  exec $SHELL -l
}

case "$1" in
  version)
    greeting
    echo -e "`basename $0` version 1.0.0\n"
    ;;
  init)
    greeting
    init
    ;;
  *)
    echo -e "\n"
    echo -e "Usage: `basename $0` <command>\n\n"
    echo -e "   version\tShow version\n"
    echo -e "   init\tSetup new environment\n"
    ;;
esac