#!/bin/bash

DOTPATH="$HOME/.dotfiles"
BACKUPPATH="$HOME/.dotfiles-backup"
COLOR_GRAY="\033[1;38;5;243m"
COLOR_BLUE="\033[1;34m"
COLOR_GREEN="\033[1;32m"
COLOR_RED="\033[1;31m"
COLOR_PURPLE="\033[1;35m"
COLOR_YELLOW="\033[1;33m"
COLOR_NONE="\033[0m"

greeting() {
  echo -e "Hello, ${COLOR_BLUE}dotfiles${COLOR_NONE}.\n"
}

has() {
  type "$1" > /dev/null 2>&1
}

error() {
  echo -e "${COLOR_RED}Error: ${COLOR_NONE}$1"
  exit 1
}

init() {
  cd ${DOTPATH}

  echo -e "Start to install Homebrew..."
  which brew >/dev/null 2>&1 || \
  /usr/bin/ruby -e \
    "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
  which brew >/dev/null 2>&1 && brew doctor
  which brew >/dev/null 2>&1 && brew update --verbose

  echo -e "Start to upgrade Homebrew..."
  brew upgrade

  echo -e "Start to install brew formulas..."
  brew bundle --verbose
  brew cleanup
  exec $SHELL -l
}

update() {
  echo -e "Start to update dotfiles..."
  cd ${DOTPATH}
  git pull origin main
}

case "$1" in
  version)
    greeting
    echo -e "`basename $0` version 1.0.0"
    ;;
  init)
    greeting
    init
    ;;
  update)
    greeting
    update
    ;;
  *)
    echo -e "Usage: `basename $0` <command>"
    echo -e "   version       Show version"
    echo -e "   init          Setup new environment"
    echo -e "   update        Update dotfiles and this repo"
    ;;
esac